<%- include('../layout/userLayouts/header') -%>


    <body>

        <!-- Start Header Area -->
        <header class="header_area sticky-header">
            <div class="main_menu">
                <nav class="navbar navbar-expand-lg navbar-light main_box">
                    <div class="container">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <a class="navbar-brand logo_h" href="index.html"><img src="img/logo.png" alt=""></a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                            <ul class="nav navbar-nav menu_nav ml-auto">
                                <li class="nav-item "><a class="nav-link" href="/home">Home</a></li>
                                <li class="nav-item submenu dropdown active">
                                    <a href="/shop" class="nav-link dropdown-toggle" role="button"
                                        aria-haspopup="true">Shop</a>
                                </li>
                                <li class="nav-item "><a class="nav-link" href="#">about</a></li>

                                <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>

                                <li class="nav-item submenu dropdown">
                                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
                                        aria-haspopup="true" aria-expanded="false"><i class="fa-solid fa-user"></i></a>
                                    <ul class="dropdown-menu">
                                        <% if (locals.user) { %>
                                            <li class="nav-item"><a class="nav-link" href="/profile">Profile</a></li>
                                            <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
                                            <% } else { %>
                                                <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
                                                <% } %>
                                    </ul>
                                </li>

                            </ul>
                            <ul class="nav navbar-nav navbar-right">
                                <li class="nav-item"><a href="/cart" class="cart"><span class="ti-bag"></span></a></li>
                                <li class="nav-item">
                                    <button class="search"><span class="lnr lnr-magnifier" id="search"></span></button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="search_input" id="search_input_box">
                <div class="container">
                    <form class="d-flex justify-content-between" action="/shop" method="GET">
                        <input type="text" class="form-control" id="search_input" name="search" placeholder="Search Here">
                        <button type="submit" class="btn"></button>
                        <span class="lnr lnr-cross" id="close_search" title="Close Search"></span>
                    </form>
                </div>
            </div>
        </header>
        <!-- End Header Area -->

        <!-- Start Banner Area -->
        <section class="banner-area organic-breadcrumb" style="
        margin-bottom: 77px;">
            <div class="container">
                <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
                    <div class="col-first">
                        <h1>Shop Category page</h1>
                        <nav class="d-flex align-items-center">
                            <a href="index.html">Home<span class="lnr lnr-arrow-right"></span></a>
                            <a href="#">Shop<span class="lnr lnr-arrow-right"></span></a>
                            <a href="category.html">Fashon Category</a>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
        <!-- End Banner Area -->


        <div class="container">
            <div class="row">
                <div class="col-xl-3 col-lg-4 col-md-5">
                    <div class="sidebar-categories">
                        <div class="head">Browse Categories</div>
                        <ul class="main-categories">
                            <li class="main-nav-list"><a href="/shop" aria-expanded="false"
                                    aria-controls="fruitsVegetable"><span class="lnr lnr-arrow-right"></span>
                                    All Categories<span class="number"></span>
                                </a>
                            </li>
                            <% if(categories.length> 0) { %>
                                <% for(let i=0; i< categories.length; i++) { %>
                                    <li class="main-nav-list"><a href="/shop?categoryId=<%=categories[i].name%>"
                                            aria-expanded="false" aria-controls="fruitsVegetable"><span
                                                class="lnr lnr-arrow-right"></span>
                                            <%=categories[i].name%><span class="number"></span>
                                        </a>
                                    </li>
                                    <% } %>
                                        <% } else { %>

                                            <% } %>
                        </ul>
                    </div>
                    <div class="sidebar-filter mt-50">
                        <div class="top-filter-head">Product Filters</div>
                        <div class="common-filter">
                            <div class="head">Price</div>
                            <div class="price-range-area">
                                <div id="price-range"></div>
                                <div class="value-wrapper d-flex">
                                    <div class="price">Price:</div>
                                    <span>$</span>
                                    <div id="lower-value"></div>
                                    <div class="to">to</div>
                                    <span>$</span>
                                    <div id="upper-value"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-8 col-md-7">
                    <!-- Start Filter Bar -->
                    <div class="filter-bar d-flex flex-wrap align-items-center" style="height: 40px;">
                        <div class="sorting ">
                            <!-- <select>
                                <option value="1">Default sorting</option>
                                <option value="1">Default sorting</option>
                                <option value="1">Default sorting</option>
                            </select> -->
                        </div>
                        <!-- <div class="sorting mr-auto">
                            <select>
                                <option value="1">Show 12</option>
                                <option value="1">Show 12</option>
                                <option value="1">Show 12</option>
                            </select>
                        </div>
                        <div class="pagination">
                            <a href="#" class="prev-arrow"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></a>
                            <a href="#" class="active">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <a href="#" class="dot-dot"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a>
                            <a href="#">6</a>
                            <a href="#" class="next-arrow"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>
                        </div> -->
                    </div>
                    <!-- End Filter Bar -->

                    <!-- Start Best Seller -->
                    <section class="lattest-product-area pb-40 category-list">
                        <div class="row">
                            <% if(products.length> 0) { %>
                                <% for(let i=0; i < products.length; i++) { %>
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="single-product">
                                            <img class="img-fluid" src="/sharpImages/<%= products[i].image[0] %>"
                                                alt="">
                                            <div class="product-details">
                                                <h6>
                                                    <%= products[i].name%>
                                                </h6>
                                                <div class="price">
                                                    <h6>$<%= products[i].price%>
                                                    </h6>
                                                    <h6 class="l-through">$2210.00</h6>
                                                </div>
                                                <div class="prd-bottom">
                                                    <a href="#" class="social-info addToCartBtn"
                                                        data-productId="<%= products[i]._id %>"
                                                        data-stockQuantity="<%= products[i].stockQuantity %>">
                                                        <span class="ti-bag"></span>
                                                        <p class="hover-text">Add to Cart</p>
                                                    </a>

                                                    <a href="" class="social-info">
                                                        <span class="lnr lnr-heart"></span>
                                                        <p class="hover-text">Wishlist</p>
                                                    </a>
                                                    <!-- <a href="" class="social-info">
                                                        <span class="lnr lnr-sync"></span>
                                                        <p class="hover-text">compare</p>
                                                    </a> -->
                                                    <a href="/productDetails?id=<%= products[i].id %>"
                                                        class="social-info">
                                                        <span class="lnr lnr-move"></span>
                                                        <p class="hover-text">View More</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } else { %>
                                            <div class="col-12 text-center">
                                                <p>No products available.</p>
                                            </div>
                                            <% } %>
                        </div>
                    </section>
                    <!-- End Best Seller -->



                    <!-- Start Filter Bar -->
                    <div class="filter-bar d-flex flex-wrap align-items-center">
                        <!-- <div class="sorting mr-auto">
                            <select>
                                <option value="1">Show 12</option>
                                <option value="1">Show 12</option>
                                <option value="1">Show 12</option>
                            </select>
                        </div> -->
                        <div class="pagination">
                            <% if (hasPreviousPage) { %>
                                <a href="/shop?page=<%= currentPage - 1 %>" class="prev-arrow"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></a>
                            <% } %>
                            <% for(let i = 1; i <= totalPages; i++) { %>
                                <% if (i === currentPage) { %>
                                    <a href="#" class="active"><%= i %></a>
                                <% } else { %>
                                    <a href="/shop?page=<%= i %>"><%= i %></a>
                                <% } %>
                            <% } %>
                            <% if (hasNextPage) { %>
                                <a href="/shop?page=<%= currentPage + 1 %>" class="next-arrow"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>
                            <% } %>
                        </div>
                    </div>
                    <!-- End Filter Bar -->
                </div>
            </div>
        </div>

        <!-- Start related-product Area -->
        <section class="related-product-area section_gap">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <div class="section-title">
                            <h1>Deals of the Week</h1>
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                incididunt ut labore et dolore
                                magna aliqua.</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-9">
                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r1.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r2.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r3.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r5.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r6.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r7.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r9.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r10.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6">
                                <div class="single-related-product d-flex">
                                    <a href="#"><img src="img/r11.jpg" alt=""></a>
                                    <div class="desc">
                                        <a href="#" class="title">Black lace Heels</a>
                                        <div class="price">
                                            <h6>$189.00</h6>
                                            <h6 class="l-through">$210.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ctg-right">
                            <a href="#" target="_blank">
                                <img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End related-product Area -->

        <%- include('../layout/userLayouts/footer') -%>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    document.querySelectorAll('.addToCartBtn').forEach(function (button) {
                        button.addEventListener('click', async function (event) {
                            try {
                                event.preventDefault(); // Prevent the default form submission behavior

                                const productId = button.getAttribute('data-productId');
                                const stockQuantity = button.getAttribute('data-stockQuantity');

                                // Check if the stock quantity is greater than or equal to 1
                                if (parseInt(stockQuantity) >= 1) {
                                    const response = await fetch('/addToCart', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ productId, quantity: 1 }),
                                    });

                                    const responseData = await response.json();

                                    if (responseData.success) {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Item added to cart successfully!',
                                            showConfirmButton: true,
                                            showCancelButton: true,
                                            confirmButtonText: 'Go to Cart',
                                            cancelButtonText: 'Continue Shopping',
                                        }).then((result) => {
                                            if (result.isConfirmed) {
                                                window.location.href = '/cart';
                                            } else {
                                                window.location.href = '/shop';
                                            }
                                        });
                                    } else {
                                        alert('Error adding item to cart.');
                                    }
                                } else {
                                    // Stock quantity is less than 1, show a SweetAlert message
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Out of Stock',
                                        text: 'Sorry, this item is out of stock.',
                                        confirmButtonText: 'OK',
                                    });
                                }
                            } catch (error) {
                                console.error('An error occurred:', error);
                            }
                        });
                    });
                });

            </script>